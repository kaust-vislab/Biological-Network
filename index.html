<!DOCTYPE html>
<meta charset="utf-8">
<title>Species Chord Diagram</title>
<style>

/*@import url(style.css);
*/
#circle circle {
  fill: none;
  pointer-events: all;
}

.group path {
  fill-opacity: 1;
  stroke: #000;
  stroke-width: .25px;
}

path.chord {
  stroke: #000;
  stroke-width: .25px;
  fill-opacity: .45;
  stroke-opacity: .8;
}

#circle:hover path.fade {
  display: none;
}

</style>

<!-- <p>Built with <a href="http://d3js.org/">d3.js</a>. -->
<body>


<div style="text-align:center; margin-top: -2px;">
<button type="button"  id='quan' onclick="updatequan()"  style= "background-color: hsl(119, 33%, 65%); border-color: rgba(5, 12, 7, 0.5); border-width: 3px;">Quantitative Data</button>
<button type="button"  id='qual' onclick="updatequal()" style= "background-color: hsl(119, 33%, 65%);border-color: hsl(119, 33%, 65%); border-width: 3px;" >Qualitative Data</button>
<br>
<button type="button"  id='taxa' onclick="updatetaxa()"  style= "background-color: hsl(119, 33%, 65%); border-color: rgba(5, 12, 7, 0.5); border-width: 3px;     margin-top: 2px">Taxa Group</button>
<button type="button"  id='trophical' onclick="updatetrophical()" style= "background-color: hsl(119, 33%, 65%);border-color: hsl(119, 33%, 65%); border-width: 3px;" >Trophical Group</button>
 <br>
<button type="button"  id='all' onclick="allchords()" style= "background-color: #ccc ;border-color: #333; border-width: 3px;     margin-top: 2px" >Show All Chords </button>
<button type="button"  id='pos' onclick="positivechords()" style= "background-color: hsl(119, 33%, 65%) ;border-color: #8bc48a ; border-width: 3px;" >Show Only Positive</button>
<button type="button"  id='neg' onclick="negativechords()" style= "background-color:  hsl(1, 97%, 77%);border-color: #fd8b8a; border-width: 3px;" >Show Only Negative</button>
<button id='saveButton' style="margin-top: 30px;     margin-left: -320px; position: absolute; border: 1px solid; border-color: #245580;border-radius: 4px; font-size: 12px;height: 30px;" onclick="svgToPng()">Export Vis to PNG</button>

<select id="fulloptions_select" onchange="OptionChange(this)" style ="margin-top: 30px; margin-left: -200px; position: absolute; background: hsl(119, 33%, 65%);  border-width: thick; 
                                       font-size: 12px;height: 30px; border: 1px solid; border-color: hsl(119, 33%, 65%);border-radius: 4px;">
                                       <option value="18">FontSize:18</option>
                                       <option value="20">FontSize:20</option>
                                       <option value="22">FontSize:22</option>
                                       <option value="24">FontSize:24</option>
                                       <option value="26">FontSize:26</option>
                                       <option value="28">FontSize:28</option>
                                       <option value="30">FontSize:30</option>
                                       <option value="32">FontSize:32</option>                                       
</select>

</div>


<script src="https://d3js.org/d3.v2.min.js?2.8.1"></script>
<!-- <script src="https://rawgit.com/exupero/saveSvgAsPng/gh-pages/saveSvgAsPng.js"></script> -->
<script src="saveSvgAsPng.js"></script>
  <script src="d3.layout.chord.sort.js"></script>

<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
  <!-- <link rel="stylesheet" href="bootstrap.min.css"> -->
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></script>
 -->
<script>



function svgToPng() {
            saveSvgAsPng(d3.select('svg').node(), 'vis.png', {scale:3.5});
}  


var width = $(window).width(),//1200,
    height = $(window).height()-20,
    outerRadius = Math.min(width, height) / 2 - 145,
    innerRadius = outerRadius - 28;

var formatPercent = d3.format(".3f");

var arc = d3.svg.arc()
    .innerRadius(innerRadius)
    .outerRadius(outerRadius);

var layout = customChordLayout()// d3.layout.chord()
    .padding(.045)
    .sortSubgroups(d3.descending)
    .sortChords(d3.ascending);

var path = d3.svg.chord()
    .radius(innerRadius-5);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", $(window).height())
  .append("g")
    .attr("id", "circle")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.append("circle")
    .attr("r", outerRadius);
  
  
  
  
var cities = ["X","Y","Z","Dummy","C","B","A","Dummy"];


var matrix = [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.748858227848101,0.258806666666667,0,0,0.292722222222222,0.348903125,0.466692,0.0361333333333333,1.3337,0.177406060606061,0.122817171717172,0.452441666666667,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.654604545454545,0.201983333333333,0,0.603457142857143,0,0.213875,0,0,0,2.064875,0.58548125,0,0.1214,0.1682],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.5189,0,0,0,0,0,0,0,0,0,0.56935,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.129783333333333,0,0,0,0,0,0.3029,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.75112,0.7287,0,0.3463,0,0.835714285714286,0,0,0,0.461388461538462,0.718363157894737,0.2692,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.141533333333333,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,2.7898,0,0,0,0,0,0.19865,0,0,0.405366666666667,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.227832,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2044,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.8301,0,0,0.26195,0.5346,0.894,0.3703,0,0,0.5641,0,0,0.4671,0.5442],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.80635,0.33187619047619,1.02551666666667,0.14415,0,0.149746153846154,0,0.494216666666667,2.3009,0.528394444444444,0.33693982300885,0,0,0.824375],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.77424,0.624966666666667,0.352910526315789,0,1.7448,0,0.199866666666667,0.261933333333333,0,0.00949534883720931,0.041846511627907,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5783,0,0,0,0.122533333333333,0.443833333333333,0,0,5e-05,1.1807375,0,0.796,0],
[0.748858227848101,0.654604545454545,0.5189,0,0.75112,0,2.7898,0,0,0.8301,0.80635,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.258806666666667,0.201983333333333,0,0,0.7287,0,0,0,0,0,0.33187619047619,0.77424,0.5783,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1.02551666666667,0.624966666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.603457142857143,0,0,0.3463,0,0,0,0,0.26195,0.14415,0.352910526315789,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.292722222222222,0,0,0.129783333333333,0,0,0,0,0,0.5346,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.348903125,0.213875,0,0,0.835714285714286,0.141533333333333,0,0,0,0.894,0.149746153846154,1.7448,0.122533333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.466692,0,0,0,0,0,0.19865,0,0,0.3703,0,0,0.443833333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.0361333333333333,0,0,0,0,0,0,0.227832,0,0,0.494216666666667,0.199866666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.3337,0,0,0,0,0,0,0,0.2044,0,2.3009,0.261933333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.177406060606061,2.064875,0,0,0.461388461538462,0,0.405366666666667,0,0,0.5641,0.528394444444444,0,5e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.122817171717172,0.58548125,0.56935,0.3029,0.718363157894737,0,0,0,0,0,0.33693982300885,0.00949534883720931,1.1807375,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.452441666666667,0,0,0,0.2692,0,0,0,0,0,0,0.041846511627907,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.1214,0,0,0,0,0,0,0,0.4671,0,0,0.796,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.1682,0,0,0,0,0,0,0,0.5442,0.824375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]

var matrix2 = [
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.748858227848101,-0.258806666666667,0,0,-0.292722222222222,-0.348903125,0.466692,0.0361333333333333,-1.3337,0.177406060606061,-0.122817171717172,-0.452441666666667,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.654604545454545,0.201983333333333,0,0.603457142857143,0,0.213875,0,0,0,-2.064875,-0.58548125,0,0.1214,0.1682],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.5189,0,0,0,0,0,0,0,0,0,0.56935,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.129783333333333,0,0,0,0,0,0.3029,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.75112,-0.7287,0,0.3463,0,-0.835714285714286,0,0,0,-0.461388461538462,-0.718363157894737,-0.2692,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.141533333333333,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-2.7898,0,0,0,0,0,-0.19865,0,0,-0.405366666666667,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.227832,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.2044,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.8301,0,0,-0.26195,0.5346,0.894,0.3703,0,0,0.5641,0,0,0.4671,0.5442],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.80635,-0.33187619047619,1.02551666666667,0.14415,0,-0.149746153846154,0,0.494216666666667,-2.3009,-0.528394444444444,0.33693982300885,0,0,-0.824375],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.77424,0.624966666666667,-0.352910526315789,0,-1.7448,0,-0.199866666666667,0.261933333333333,0,0.00949534883720931,0.041846511627907,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5783,0,0,0,-0.122533333333333,0.443833333333333,0,0,5e-05,1.1807375,0,0.796,0],
[-0.748858227848101,-0.654604545454545,-0.5189,0,-0.75112,0,-2.7898,0,0,-0.8301,0.80635,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.258806666666667,0.201983333333333,0,0,-0.7287,0,0,0,0,0,-0.33187619047619,-0.77424,0.5783,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,1.02551666666667,0.624966666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.603457142857143,0,0,0.3463,0,0,0,0,-0.26195,0.14415,-0.352910526315789,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.292722222222222,0,0,-0.129783333333333,0,0,0,0,0,0.5346,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.348903125,0.213875,0,0,-0.835714285714286,-0.141533333333333,0,0,0,0.894,-0.149746153846154,-1.7448,-0.122533333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.466692,0,0,0,0,0,-0.19865,0,0,0.3703,0,0,0.443833333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.0361333333333333,0,0,0,0,0,0,-0.227832,0,0,0.494216666666667,-0.199866666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-1.3337,0,0,0,0,0,0,0,-0.2044,0,-2.3009,0.261933333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.177406060606061,-2.064875,0,0,-0.461388461538462,0,-0.405366666666667,0,0,0.5641,-0.528394444444444,0,5e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.122817171717172,-0.58548125,0.56935,0.3029,-0.718363157894737,0,0,0,0,0,0.33693982300885,0.00949534883720931,1.1807375,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.452441666666667,0,0,0,-0.2692,0,0,0,0,0,0,0.041846511627907,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.1214,0,0,0,0,0,0,0,0.4671,0,0,0.796,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0.1682,0,0,0,0,0,0,0,0.5442,-0.824375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]



var matrix3 = [
[0,0,0,0,0,-0.333999504950495,0.299738775510204,0.1156,-0.485628571428571,-0.161723684210526,-0.164674137931034],
[0,0,0,0,0,-0.4061875,-0.521156910569106,0.576021428571429,-0.255536206896552,0.31941,0.356839230769231],
[0,0,0,0,0,-0.2818,0,0,1.35188,0,0],
[0,0,0,0,0,-0.644659259259259,-0.720364285714286,0.31261,-0.439666666666667,0.384973684210526,-0.303262962962963],
[0,0,0,0,0,-0.789766666666667,-0.354020833333333,0.09585,-1.285,-0.141214285714286,-0.299452],
[-0.333999504950495,-0.4061875,-0.2818,-0.644659259259259,-0.789766666666667,0,0,0,0,0,0],
[0.299738775510204,-0.521156910569106,0,-0.720364285714286,-0.354020833333333,0,0,0,0,0,0],
[0.1156,0.576021428571429,0,0.31261,0.09585,0,0,0,0,0,0],
[-0.485628571428571,-0.255536206896552,1.35188,-0.439666666666667,-1.285,0,0,0,0,0,0],
[-0.161723684210526,0.31941,0,0.384973684210526,-0.141214285714286,0,0,0,0,0,0],
[-0.164674137931034,0.356839230769231,0,-0.303262962962963,-0.299452,0,0,0,0,0,0]
]

var matrix4 = [
[0,0,0,0,0,0.333999504950495,0.299738775510204,0.1156,0.485628571428571,0.161723684210526,0.164674137931034],
[0,0,0,0,0,0.4061875,0.521156910569106,0.576021428571429,0.255536206896552,0.31941,0.356839230769231],
[0,0,0,0,0,0.2818,0,0,1.35188,0,0],
[0,0,0,0,0,0.644659259259259,0.720364285714286,0.31261,0.439666666666667,0.384973684210526,0.303262962962963],
[0,0,0,0,0,0.789766666666667,0.354020833333333,0.09585,1.285,0.141214285714286,0.299452],
[0.333999504950495,0.4061875,0.2818,0.644659259259259,0.789766666666667,0,0,0,0,0,0],
[0.299738775510204,0.521156910569106,0,0.720364285714286,0.354020833333333,0,0,0,0,0,0],
[0.1156,0.576021428571429,0,0.31261,0.09585,0,0,0,0,0,0],
[0.485628571428571,0.255536206896552,1.35188,0.439666666666667,1.285,0,0,0,0,0,0],
[0.161723684210526,0.31941,0,0.384973684210526,0.141214285714286,0,0,0,0,0,0],
[0.164674137931034,0.356839230769231,0,0.303262962962963,0.299452,0,0,0,0,0,0]
]



//*********************************************Qual*******************

//qualitative==july
var matrixjuly = [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.833333333333333,0.666666666666667,0.5,1.5,0.4,0,1,0.625,0.25,0,0,1,0.36,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.125,0,0,0,0,0,0,1,1,0.5,0,0.4,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,0,2.5,0,0,2,0.444444444444444,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0,0,0,1,0,0.333333333333333,0,0,2,0,0.142857142857143,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.5,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,1,0,3,0,0,0,0,0,0,1.04761904761905,0.5,0,1,1,0.0526315789473684,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0.727272727272727,1,0,0,0,0.8,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0.285714285714286,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.66666666666667,2.33333333333333,0,0,0],
[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0],
[0.833333333333333,0,0,1,0,0.25,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.666666666666667,0.125,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,1,2],
[0.5,0,0.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.5,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.4,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.625,0,0,1,0,0.333333333333333,1.5,1.04761904761905,0.727272727272727,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.25,1,0,0,2.5,0,0,0.5,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0],
[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0],
[0,0.5,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.5],
[1,0,0,0,2,0,0,1,0,0,1.66666666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.36,0.4,0,2,0.444444444444444,0.142857142857143,0,0.0526315789473684,0.8,0.285714285714286,2.33333333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,2],
[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0.5,0,0,0,0,0,0,2,0.5,0,0,2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1.5,0,2,0,0,0]
]

var matrix2july=[ 
[0,0,0,0,0,0,0,0,0,0,0,0,0,-0.833333333333333,-0.666666666666667,-0.5,-1.5,-0.4,0,-1,-0.625,0.25,0,0,-1,0.36,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.125,0,0,0,0,0,0,1,-1,-0.5,0,-0.4,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.5,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,-1,0,0,-1,0,0,0,0,2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-2,0,0,0,-2.5,0,0,-2,-0.444444444444444,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0.25,0,0,0,0,1,0,-0.333333333333333,0,0,2,0,-0.142857142857143,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.5,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,-1,0,-3,0,0,0,0,0,0,-1.04761904761905,0.5,0,1,-1,0.0526315789473684,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,-0.727272727272727,-1,0,0,0,-0.8,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,-0.285714285714286,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.66666666666667,-2.33333333333333,0,0,0],
[0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0],
[-0.833333333333333,0,0,-1,0,0.25,0,-3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.666666666666667,-0.125,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.5,-1,-2],
[-0.5,0,-0.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-1.5,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.4,0,0,-1,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[-0.625,0,0,-1,0,-0.333333333333333,-1.5,-1.04761904761905,-0.727272727272727,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.25,1,0,0,-2.5,0,0,0.5,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0],
[0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.5,0,0],
[0,-0.5,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1.5],
[-1,0,0,0,-2,0,0,-1,0,0,-1.66666666666667,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.36,-0.4,0,2,-0.444444444444444,-0.142857142857143,0,0.0526315789473684,-0.8,-0.285714285714286,-2.33333333333333,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,-2],
[0,0,0,0,0,0,0,0,0,0,0,0,-2,0,-0.5,0,0,0,0,0,0,-2,-0.5,0,0,-2,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,0,-1.5,0,-2,0,0,0]
]

//qualitative==july
var matrix3july = [
[0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,-1.4,0,-2,-1,-0.636363636363636,0,0,0,0],
[0,0,0,0,0,0,0.5,-0.533333333333333,-0.214285714285714,-0.333333333333333,-0.166666666666667,0,0,0,0],
[0,0,0,0,0,0,-1,0,-1,0,-0.260869565217391,0,0,0,0],
[0,0,0,0,0,0,-2,-0.625,-1,1,0,0,0,0,0],
[0,0,0,0,0,0,-1.5,-1,-0.666666666666667,-0.6,-1.40909090909091,0,0,0,0],
[-1,-1.4,0.5,-1,-2,-1.5,0,0,0,0,0,-2,0,0,0],
[0,0,-0.533333333333333,0,-0.625,-1,0,0,0,0,0,-0.6875,-2,-1,0],
[0,-2,-0.214285714285714,-1,-1,-0.666666666666667,0,0,0,0,0,0,0,0,0],
[0,-1,-0.333333333333333,0,1,-0.6,0,0,0,0,0,0,0,-2,-1.33333333333333],
[0,-0.636363636363636,-0.166666666666667,-0.260869565217391,0,-1.40909090909091,0,0,0,0,0,-0.5,0,-1,0],
[0,0,0,0,0,0,-2,-0.6875,0,0,-0.5,0,0,0,0],
[0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,-1,0,-2,-1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,-1.33333333333333,0,0,0,0,0]
]

var matrix4july = [
[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1.4,0,2,1,0.636363636363636,0,0,0,0],
[0,0,0,0,0,0,0.5,0.533333333333333,0.214285714285714,0.333333333333333,0.166666666666667,0,0,0,0],
[0,0,0,0,0,0,1,0,1,0,0.260869565217391,0,0,0,0],
[0,0,0,0,0,0,2,0.625,1,1,0,0,0,0,0],
[0,0,0,0,0,0,1.5,1,0.666666666666667,0.6,1.40909090909091,0,0,0,0],
[1,1.4,0.5,1,2,1.5,0,0,0,0,0,2,0,0,0],
[0,0,0.533333333333333,0,0.625,1,0,0,0,0,0,0.6875,2,1,0],
[0,2,0.214285714285714,1,1,0.666666666666667,0,0,0,0,0,0,0,0,0],
[0,1,0.333333333333333,0,1,0.6,0,0,0,0,0,0,0,2,1.33333333333333],
[0,0.636363636363636,0.166666666666667,0.260869565217391,0,1.40909090909091,0,0,0,0,0,0.5,0,1,0],
[0,0,0,0,0,0,2,0.6875,0,0,0.5,0,0,0,0],
[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,1,0,2,1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,1.33333333333333,0,0,0,0,0]
]
//***********************************************************************
var taxaortroph = true;  // true for taxa false for trophical
var group_filename= "species-taxa-quant.csv";
var matrix_name="matrix2quant.json";


taxa();

var quanorqual=true; //true for quan

var text_f_size = 20;
function OptionChange(val) {
    //console.log(val.value);
    text_f_size = val.value;
    if(quanorqual) updatequan();
    else  updatequal();

}

 //Append Legends
var teams = [
  "Marine Exotic Species" ,
  "Marine Native Species",
   "",
  "Increase Change",
  "Decrease Change",
];
//"Terrestrial Exotic Species",
var colors = [  "#083E77", "#6495ED","transparent","green","red"];  //, "#8a2c11"


function updatequan(){
  quanorqual=true;
  $('#quan')["0"].style.borderColor= "rgba(5, 12, 7, 0.5)";
  // $('#taxa')["0"].style.backgroundColor= "#5a9e16";

   $('#qual')["0"].style.borderColor= "hsl(119, 33%, 65%)";  
   $('#qual')["0"].style.backgroundColor= "hsl(119, 33%, 65%)";


if(taxaortroph)  updatetaxa();
else updatetrophical();

}

function updatequal(){
  quanorqual=false;
   $('#qual')["0"].style.borderColor= "rgba(5, 12, 7, 0.5)";
  // $('#taxa')["0"].style.backgroundColor= "#5a9e16";

   $('#quan')["0"].style.borderColor= "hsl(119, 33%, 65%)";  
   $('#quan')["0"].style.backgroundColor= "hsl(119, 33%, 65%)";

   if(taxaortroph)  updatetaxa();
   else updatetrophical();
}

function updatetaxa(){
  taxaortroph = true; 
  if(quanorqual){
    group_filename= "species-taxa-quant.csv";
    matrix_name="matrix2quant.json";
  }
  else{
    group_filename= "species-taxa-rm.csv";
    matrix_name="matrix2.json";
  }

   $('#taxa')["0"].style.borderColor= "rgba(5, 12, 7, 0.5)";
  // $('#taxa')["0"].style.backgroundColor= "#5a9e16";

   $('#trophical')["0"].style.borderColor= "hsl(119, 33%, 65%)";  
   $('#trophical')["0"].style.backgroundColor= "hsl(119, 33%, 65%)";

 d3.select("body").selectAll("svg").remove();
 d3.select("#foot").remove();

   svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("id", "circle")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.append("circle")
    .attr("r", outerRadius);

  taxa();
  var iDiv = document.createElement('div');
  iDiv.id = 'foot';
  iDiv.className = 'block';
  document.getElementsByTagName('body')[0].appendChild(iDiv);
  //iDiv.innerHTML = " <a href='https://kvl.kaust.edu.sa/Pages/Home.aspx'>Created By KAUST Visualization Core Lab, August 2017</a>";

var html = '<div id="foot" <ul class="footer" style = "margin: -110px 0 0 0;margin-left: 500px; border-top: 0px dotted #aaa; padding: 0.1px 0 0 0;  text-align: right;  "> <li style="display: inline-block; font-size: small;"><a href="https://kvl.kaust.edu.sa/Pages/Home.aspx">Created By KAUST Visualization Core Lab, February 2019</a></li></div>'
$('#foot').html(html);


//  if (showchords==2){
//        svg.selectAll(".chord").style("opacity", function(d){
//          if(matrix2[d.source.index][d.target.index] < 0) return 0;
//          else return 1;
//         })
//  }
//  else if(showchords==3) {
//       svg.selectAll(".chord").style("opacity", function(d){
//          if(matrix2[d.source.index][d.target.index] > 0) return 0;
//          else return 1;
//       })
// }
}

function updatetrophical(){
  taxaortroph = false; 
  if(quanorqual){
     group_filename= "species-trophical-quant.csv";
     matrix_name="matrix3quant.json";
  }
  else{
     group_filename= "species-trophical-rm.csv";
     matrix_name="matrix3.json";
  }

    $('#trophical')["0"].style.borderColor= "rgba(5, 12, 7, 0.5)";
  // $('#taxa')["0"].style.backgroundColor= "#5a9e16";

   $('#taxa')["0"].style.borderColor= "hsl(119, 33%, 65%)";  
   $('#taxa')["0"].style.backgroundColor= "hsl(119, 33%, 65%)"; 

  d3.select("body").selectAll("svg").remove();
  d3.select("#foot").remove();

   svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("id", "circle")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.append("circle")
    .attr("r", outerRadius);

  trophical();
  var iDiv = document.createElement('div');
  iDiv.id = 'foot';
  iDiv.className = 'block';
  document.getElementsByTagName('body')[0].appendChild(iDiv);
  //iDiv.innerHTML = " <a href='https://kvl.kaust.edu.sa/Pages/Home.aspx'>Created By KAUST Visualization Core Lab, August 2017</a>";
  var html = '<div id="foot" <ul class="footer" style = "margin: -110px 0 0 0;margin-left: 500px; border-top: 0px dotted #aaa; padding: 0.1px 0 0 0;  text-align: right;  "> <li style="display: inline-block; font-size: small;"><a href="https://kvl.kaust.edu.sa/Pages/Home.aspx">Created By KAUST Visualization Core Lab, February 2019</a></li></div>'
$('#foot').html(html);
 //  if (showchords==2){
 //       svg.selectAll(".chord").style("opacity", function(d){
 //         if(matrix3[d.source.index][d.target.index] < 0) return 0;
 //         else return 1;
 //        })
 // }
 // else if(showchords==3) {
 //      svg.selectAll(".chord").style("opacity", function(d){
 //         if(matrix3[d.source.index][d.target.index] > 0) return 0;
 //         else return 1;
 //      })
 //  }
}

function trophical(){
  d3.csv(group_filename, function(cities) {
  d3.json(matrix_name, function(matrix2) {

    // Compute the chord layout.
    if(quanorqual) layout.matrix(matrix4);
    else layout.matrix(matrix4july); //qualitative data

    // Add a group per neighborhood.
    var group = svg.selectAll(".group")
        .data(layout.groups)
      .enter().append("g")
        .attr("class", "group")        
        .on("mouseover", mouseover)
        .on("mouseout", mouseout);

    // Add a mouseover title.
    group.append("title").text(function(d, i) {
       return cities[i].name + ", Total Value:" + formatPercent(d.value) 
    });

    // Add the group arc.
    var groupPath = group.append("path")
        .attr("id", function(d, i) { return "group" + i; })
        .attr("d", arc)
        .style("fill", function(d, i) { return cities[i].color; });

    // Add a text label.
    var groupText = group.append("text")
        //.attr("x", function(d, i){console.log( groupPath[0][i].getTotalLength()/2);})   //6
        .attr("dy", 15)
         

//     groupText.append("textPath")
//         .attr("xlink:href", function(d, i) { return "#group" + i; })
//         .text(function(d, i) { return cities[i].name; });

    // Remove the labels that don't fit. :(
//     groupText.filter(function(d, i) { return groupPath[0][i].getTotalLength() / 2 - 30 < this.getComputedTextLength(); })
//         .remove();
    
    
    
      group.append("svg:text")
      .each(function(d,i) { d.angle = (d.startAngle + d.endAngle) / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
      .attr("transform", function(d) {
        return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
            + "translate(" + (innerRadius + 30) + ")"
            + (d.angle > Math.PI ? "rotate(180)" : "");
      })
      .text(function(d,i) { return cities[i].name; })
      .style("fill", function(d, i) { return cities[i].color; })
    .attr("shape-rendering","crispEdges")
    .attr("font-family","Arial")
    .attr("font-size", text_f_size+ "px");
    
    
    
    
    
    

    // Add the chords.
    var chord = svg.selectAll(".chord")
        .data(layout.chords)
      .enter().append("path")
        .attr("class", "chord")
        .style("fill", function(d,i) { 
          //console.log(d);
          //console.log(matrix2[d.source.index][d.target.index]);
          if(matrix2[d.source.index][d.target.index] < 0) return 'red';
          else return 'green';
          //return cities[d.source.index].color; 
        })
        .style("opacity", function(d){
           if (showchords==2){
             if(matrix2[d.source.index][d.target.index] < 0) return 0;
             else return 1;
           }
           else if (showchords==3){
             if(matrix2[d.source.index][d.target.index] > 0) return 0;
             else return 1;
           }
        })
        .attr("d", path)
        .on("mouseover", chordmouseover)
        .on("mouseout", chordmouseout);

    //Add an elaborate mouseover title for each chord.
    chord.append("title").text(function(d) {
      var temp=1;
      if(matrix2[d.source.index][d.target.index] < 0) temp=-1;
      return cities[d.source.index].name
          + " → " + cities[d.target.index].name
          + ": " + formatPercent(d.source.value*temp)
          + "\n" + cities[d.target.index].name
          + " → " + cities[d.source.index].name
          + ": " + formatPercent(d.target.value*temp);
    });

    function mouseover(d, i) {
      // chord.classed("fade", function(p) {
      //   return p.source.index != i
      //       && p.target.index != i;
      // });
       svg.selectAll("path.chord")
        .filter(function(d) { 
          //console.log(d);
          if(showchords==1)  return d.source.index !== i && d.target.index !== i; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return d.source.index !== i && d.target.index !== i; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return d.source.index !== i && d.target.index !== i; 
          }
        })
        .transition()
        .style("opacity", 0.15);
    }
    function mouseout(d, i) {
       svg.selectAll("path.chord")
        .filter(function(d) { 
          if(showchords==1)  return d.source.index !== i && d.target.index !== i; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return d.source.index !== i && d.target.index !== i; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return d.source.index !== i && d.target.index !== i; 
          }
        })
        .transition()
        .style("opacity", 1);
    }
    
    function chordmouseover(d, i) {
      // chord.classed("fade", function(p) {
      //   return p.source.index != i
      //       && p.target.index != i;
      // });
       svg.selectAll("path.chord")
        .filter(function(d) { 
          //console.log(d);
          if(showchords==1)  return true; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return true; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return true; 
          }
        })
        .transition()
        .style("opacity", 0.15);

        if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) d3.select(this).transition().style("opacity", 1);
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) d3.select(this).transition().style("opacity", 1);
          }
          else d3.select(this).transition().style("opacity", 1);
        
    }
    function chordmouseout(d, i) {
       svg.selectAll("path.chord")
        .filter(function(d) { 
          if(showchords==1)  return true; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return true; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return true; 
          }
        })
        .transition()
        .style("opacity", 1);
    }

//  //Append Legend
// var teams = [
//   "Marine Exotics" ,
//   "Native Taxa",
//   "Terrestrial Exotics",
//   "Positive Effect",
//   "Negative Effect",
// ];

// var colors = [  "#083E77", "#BFAE40", "#8a2c11","green","red"];

var color = d3.scale.ordinal()      //custom color scale for teams
                .range(colors)
                .domain(teams);
svg.append("rect")   
.attr("x",(width/4) +60)
.attr("y",-height/2.2)
.attr("width",165)
.attr("height",120)
.attr("style","fill-opacity:0;stroke:black;stroke-width:1.5px");

var legend = svg.append("g")
    .attr("class", "legend")
    .attr("width", 150)
    .attr("height", 150)
    .attr("transform", "translate("+ ((width/4)+65) + ",-"+ ((height/2.2)-10) +" )");

var gs = legend.selectAll("g.keybox")
          .data(teams).enter().append("g")
          .attr("class", "keybox")
          .attr("width", 80)
          .attr("height", 15);

gs.append("text")
  .attr("class","keybox").attr("x",function(d,i){
    if(i<15){return 15;}
    else{return 90;}})
  .attr("y",function(d,i){
    if(i<15){return i*20 +9;}
    else{return (i-4)*20 +9;}})
  .text(function(d,i){
    return teams[i];})
  .attr("font-size","14px");
  

gs.append("rect")        
  .attr("x",function(d,i){
    if(i<15){return 0;}
    else{return 75;}})
  .attr("y",function(d,i){
     if(i<15){return i*20;}
     else{return (i-4) * 20;}})
  .attr("width",10)
  .attr("height",10)
  .style("fill",function(d, i){
    return colors[i];});



  });
});

}

//---------------------------------------------------TAXA----------------------------------------------------------------------
function taxa(){
  d3.csv(group_filename, function(cities) {
  d3.json(matrix_name, function(matrix2) {

    // Compute the chord layout.
    if(quanorqual) layout.matrix(matrix);
    else layout.matrix(matrixjuly); //qualitative data

    // Add a group per neighborhood.
    var group = svg.selectAll(".group")
        .data(layout.groups)
      .enter().append("g")
        .attr("class", "group")        
        .on("mouseover", mouseover)
        .on("mouseout", mouseout);

    // Add a mouseover title.
    group.append("title").text(function(d, i) {
       return cities[i].name + ", Total Value:" + formatPercent(d.value) 
    });

    // Add the group arc.
    var groupPath = group.append("path")
        .attr("id", function(d, i) { return "group" + i; })
        .attr("d", arc)
        .style("fill", function(d, i) { return cities[i].color; });

    // Add a text label.
    var groupText = group.append("text")
        //.attr("x", function(d, i){console.log( groupPath[0][i].getTotalLength()/2);})   //6
        .attr("dy", 15)
         

//     groupText.append("textPath")
//         .attr("xlink:href", function(d, i) { return "#group" + i; })
//         .text(function(d, i) { return cities[i].name; });

    // Remove the labels that don't fit. :(
//     groupText.filter(function(d, i) { return groupPath[0][i].getTotalLength() / 2 - 30 < this.getComputedTextLength(); })
//         .remove();
    
    
    
      group.append("svg:text")
      .each(function(d,i) { d.angle = (d.startAngle + d.endAngle) / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
      .attr("transform", function(d) {
        return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
            + "translate(" + (innerRadius + 30) + ")"
            + (d.angle > Math.PI ? "rotate(180)" : "");
      })
      .text(function(d,i) { return cities[i].name; })
      .style("fill", function(d, i) { return cities[i].color; })
    .attr("shape-rendering","crispEdges")
    .attr("font-family","Arial")
    .attr("font-size", text_f_size+"px");
    
    
    
    
    
    

    // Add the chords.
    var chord = svg.selectAll(".chord")
        .data(layout.chords)
      .enter().append("path")
        .attr("class", "chord")
        .style("fill", function(d,i) { 
          //console.log(d);
          //console.log(matrix2[d.source.index][d.target.index]);
          if(matrix2[d.source.index][d.target.index] < 0) return 'red';
          else return 'green';
          //return cities[d.source.index].color; 
        })
        .style("opacity", function(d){
           if (showchords==2){
             if(matrix2[d.source.index][d.target.index] < 0) return 0;
             else return 1;
           }
           else if (showchords==3){
             if(matrix2[d.source.index][d.target.index] > 0) return 0;
             else return 1;
           }
        })
        .attr("d", path)
        .on("mouseover", chordmouseover)
        .on("mouseout", chordmouseout);

    //Add an elaborate mouseover title for each chord.
    chord.append("title").text(function(d) {
      //console.log(matrix2[d.source.index][d.target.index]);
      var temp=1;
      if(matrix2[d.source.index][d.target.index] < 0) temp=-1;
      return cities[d.source.index].name
          + " → " + cities[d.target.index].name
          + ": " + formatPercent(d.source.value*temp)
          + "\n" + cities[d.target.index].name
          + " → " + cities[d.source.index].name
          + ": " + formatPercent(d.target.value*temp);
    });

   function mouseover(d, i) {
      // chord.classed("fade", function(p) {
      //   return p.source.index != i
      //       && p.target.index != i;
      // });
       svg.selectAll("path.chord")
        .filter(function(d) { 
          //console.log(d);
          if(showchords==1)  return d.source.index !== i && d.target.index !== i; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return d.source.index !== i && d.target.index !== i; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return d.source.index !== i && d.target.index !== i; 
          }
        })
        .transition()
        .style("opacity", 0.15);
    }
    function mouseout(d, i) {
       svg.selectAll("path.chord")
        .filter(function(d) { 
          if(showchords==1)  return d.source.index !== i && d.target.index !== i; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return d.source.index !== i && d.target.index !== i; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return d.source.index !== i && d.target.index !== i; 
          }
        })
        .transition()
        .style("opacity", 1);
    }
    
  function chordmouseover(d, i) {
      // chord.classed("fade", function(p) {
      //   return p.source.index != i
      //       && p.target.index != i;
      // });
       svg.selectAll("path.chord")
        .filter(function(d) { 
          //console.log(d);
          if(showchords==1)  return true; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return true; 
          }

          
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return true; 
          }
        })
        .transition()
        .style("opacity", 0.15);

        if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) d3.select(this).transition().style("opacity", 1);
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) d3.select(this).transition().style("opacity", 1);
          }
          else d3.select(this).transition().style("opacity", 1);
        
    }
    function chordmouseout(d, i) {
       svg.selectAll("path.chord")
        .filter(function(d) { 
          if(showchords==1)  return true; 
          else if(showchords==2) { 
             if(matrix2[d.source.index][d.target.index] > 0) return true; 
          }
          else if(showchords==3) { 
             if(matrix2[d.source.index][d.target.index] < 0) return true; 
          }
        })
        .transition()
        .style("opacity", 1);
    }

//  //Append Legend
// var teams = [
//   "Marine Exotics" ,
//   "Native Taxa",
//   "Terrestrial Exotics",
//   "Positive Effect",
//   "Negative Effect",
// ];

// var colors = [ "#083E77", "#BFAE40", "#8a2c11","green","red"]; //#DF7C00

var color = d3.scale.ordinal()      //custom color scale for teams
                .range(colors)
                .domain(teams);
svg.append("rect")   
.attr("x",(width/4) +60)
.attr("y",-height/2.2)
.attr("width",165)
.attr("height",120)
.attr("style","fill-opacity:0;stroke:black;stroke-width:1.5px");

var legend = svg.append("g")
    .attr("class", "legend")
    .attr("width", 150)
    .attr("height", 150)
    .attr("transform", "translate("+ ((width/4)+65) + ",-"+ ((height/2.2)-10) +" )");

var gs = legend.selectAll("g.keybox")
          .data(teams).enter().append("g")
          .attr("class", "keybox")
          .attr("width", 80)
          .attr("height", 15);

gs.append("text")
  .attr("class","keybox").attr("x",function(d,i){
    if(i<15){return 15;}
    else{return 90;}})
  .attr("y",function(d,i){
    if(i<15){return i*20 +9;}
    else{return (i-4)*20 +9;}})
  .text(function(d,i){
    return teams[i];})
  .attr("font-size","14px");
  

gs.append("rect")        
  .attr("x",function(d,i){
    if(i<15){return 0;}
    else{return 75;}})
  .attr("y",function(d,i){
     if(i<15){return i*20;}
     else{return (i-4) * 20;}})
  .attr("width",10)
  .attr("height",10)
  .style("fill",function(d, i){
    return colors[i];});



  });
});

} //#8bc48a #fd8b8a
var showchords=1; //1 for all. 2 for pos, 3 for neg
function allchords(){
  showchords=1;
  $('#pos')["0"].style.borderColor= "#8bc48a";
  $('#neg')["0"].style.borderColor= "#fd8b8a"; 

  $('#all')["0"].style.borderColor= "#333"; 
  svg.selectAll(".chord")
  .style("opacity", function(d){
    return 1;
  })
}

function positivechords(){
  showchords=2;
  $('#all')["0"].style.borderColor= "#ccc";
  $('#neg')["0"].style.borderColor= "#fd8b8a"; 

  $('#pos')["0"].style.borderColor= "#333"; 

  svg.selectAll(".chord").style("opacity", function(d){
    if(taxaortroph){
      if(quanorqual){
        if(matrix2[d.source.index][d.target.index] < 0) return 0;
        else return 1;
      }
      else{
        if(matrix2july[d.source.index][d.target.index] < 0) return 0;
        else return 1;
      }
    }
    else {
      if(quanorqual){
        if(matrix3[d.source.index][d.target.index] < 0) return 0;
        else return 1;
      }
      else{
        if(matrix3july[d.source.index][d.target.index] < 0) return 0;
        else return 1;
      }
    }
  })
}

function negativechords(){
  showchords=3;
  $('#all')["0"].style.borderColor= "#ccc";
  $('#pos')["0"].style.borderColor= "#8bc48a"; 

  $('#neg')["0"].style.borderColor= "#333"; 
  //console.log("tt");
  svg.selectAll(".chord")
  .style("opacity", function(d){
    if(taxaortroph){
     if(quanorqual){
        if(matrix2[d.source.index][d.target.index] > 0) return 0;
        else return 1;
      }
      else{
        if(matrix2july[d.source.index][d.target.index] > 0) return 0;
        else return 1;
      }
    }
    else {
      if(quanorqual){
        if(matrix3[d.source.index][d.target.index] > 0) return 0;
        else return 1;
      }
      else{
        if(matrix3july[d.source.index][d.target.index] > 0) return 0;
        else return 1;
      }
    }

  })
}

</script>

<div id="foot" <ul class="footer" style = "margin: -110px 0 0 0;margin-left: 500px; border-top: 0px dotted #aaa; padding: 0.1px 0 0 0;  text-align: right;  ">
        <li style="display: inline-block; font-size: small;"><a href='https://kvl.kaust.edu.sa/Pages/Home.aspx'>Created By KAUST Visualization Core Lab, February 2019</a></li>           
</div>

</body>
